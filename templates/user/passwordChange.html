{% extends 'base/base.html' %}
{% load static %}

{% block content %}
{% include 'base/message.html' %}
  <style>
    .input-valid {
      border: 2px solid green;
    }
    .input-invalid {
      border: 2px solid red;
    }
    .condition-valid {
      color: green;
    }
    .condition-invalid {
      color: red;
    }
    .disabled-button {
      background-color: grey !important;
      cursor: not-allowed !important;
    }
  </style>
  <div style="opacity: 1;" class="page-wrapper">
    <div class="w-nav-overlay" data-wf-ignore="" id="w-nav-overlay-0"></div>
  </div>
  <div class="main-section">
    <div class="container-default w-container">
      <div class="block-sticky-top---main-contain">
        <div id="w-node-_5b7b5ab1-6d00-c7e0-62e6-f29490555c22-71edfef9" class="dashboard-main-content---user-profiles">
          <div id="cards" data-w-id="c25945b2-b467-1640-757f-35242a0cbdb5" style="opacity: 1; max-width: 95vw;" class="pd-top-24px---activities">
            <h2 class="text-500 bold mg-bottom-12px">Change Password</h2>
            <div class="card component-card card-one-line">
              <div class="w-form">
                
                <form action="{% url 'user:changePassword' %}" id="wf-form-signup" name="wf-form-signup" method="post" class="container_profile-form-2" aria-label="signup">
                  {% csrf_token %}
                  <div class="spacer_m"></div>
                  <div>Use this form to change your password.</div>
                  <div class="spacer_m"></div>
                  <div class="input-wrapper">
                    <label for="old_password" class="input-label">Current password</label>
                    <i class="fa-solid fa-eye" style="position: relative; left: 95%; top: 30px;" onclick="old_password_toggle()"></i>
                    <input class="input-2 w-input" maxlength="256" name="old_password" placeholder="" type="text" id="old_password" onclick="old_password_toggle()" required />
                  </div>
                  <div class="input-wrapper">
                    <label for="new_password1" class="input-label">New password</label>
                    <i class="fa-solid fa-eye" style="position: relative; left: 95%; top: 30px;" onclick="new_password_toggle()"></i>
                    <input class="input-2 w-input" maxlength="256" name="new_password1" placeholder="" type="text" id="new_password1" required />
                  </div>
                  <div class="input-wrapper">
                    <label for="new_password2" class="input-label">Repeat new password</label>
                    <i class="fa-solid fa-eye" style="position: relative; left: 95%; top: 30px;" onclick="repeat_password_toggle()"></i>
                    <input class="input-2 w-input" maxlength="256" name="new_password2" placeholder="" type="text" id="new_password2" onclick="repeat_password_toggle()" required />
                  </div>
                  <div class="description">
                    <em>
                      * Your password: <br />
                      <span id="lengthP" class="condition-invalid">&nbsp;&nbsp;&nbsp;&nbsp;has at least 8 characters.</span><br />
                      <span id="valid-charsP" class="condition-invalid">&nbsp;&nbsp;&nbsp;&nbsp;has a combination of letters, numbers, and symbols.</span><br/>
                      <span id="matchP" class="condition-invalid">&nbsp;&nbsp;&nbsp;&nbsp;matches the confirmation password.</span>
                    </em>
                  </div>
                  <div class="spacer_m"></div>
                  <div class="block-button">
                    <input type="submit" class="log-in-button---brix w-button disabled-button" id="change-password-button" value="Change Password" disabled>
                  </div>
                </form>

            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    var lengthOK = false;
    var wordRegexOK = false;
    var confirmation = false;

    function checkChangePasswordButton() {
        const changePasswordButton = document.getElementById('change-password-button');
        if (lengthOK && wordRegexOK && confirmation) {
            changePasswordButton.disabled = false;
            changePasswordButton.classList.remove('disabled-button');
        } else {
            changePasswordButton.disabled = true;
            changePasswordButton.classList.add('disabled-button');
        }
    }

    document.getElementById('new_password1').addEventListener('input', function () {
        const passwordInput = this.value;
        const lengthP = document.getElementById('lengthP');
        const validCharsP = document.getElementById('valid-charsP');

        // Check length
        if (passwordInput.length >= 8) {
            lengthP.classList.remove('condition-invalid');
            lengthP.classList.add('condition-valid');
            lengthOK = true;
        } else {
            lengthP.classList.remove('condition-valid');
            lengthP.classList.add('condition-invalid');
            lengthOK = false;
        }

        // Check for valid characters
        const regex = /^(?=.*[a-zA-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]+$/;
        if (regex.test(passwordInput)) {
            validCharsP.classList.remove('condition-invalid');
            validCharsP.classList.add('condition-valid');
            wordRegexOK = true;
        } else {
            validCharsP.classList.remove('condition-valid');
            validCharsP.classList.add('condition-invalid');
            wordRegexOK = false;
        }

        checkChangePasswordButton();
    });

    document.getElementById('new_password2').addEventListener('input', function () {
        const passwordInput = document.getElementById('new_password1').value;
        const confirmationInput = this.value;
        const matchP = document.getElementById('matchP');

        // Check if passwords match
        if (passwordInput === confirmationInput) {
            matchP.classList.remove('condition-invalid');
            matchP.classList.add('condition-valid');
            confirmation = true;
        } else {
            matchP.classList.remove('condition-valid');
            matchP.classList.add('condition-invalid');
            confirmation = false;
        }

        checkChangePasswordButton();
    });
    function old_password_toggle() {
      var x = document.getElementById("old_password");
      if (x.type === "password") {
        x.type = "text";
      } else {
        x.type = "password";
      }
    }
    function new_password_toggle() {
      var x = document.getElementById("new_password1");
      if (x.type === "password") {
        x.type = "text";
      } else {
        x.type = "password";
      }
    }
    function repeat_password_toggle() {
      var x = document.getElementById("new_password2");
      if (x.type === "password") {
        x.type = "text";
      } else {
        x.type = "password";
      }
    }
  </script>
  <br><br><br>
{% endblock %}
